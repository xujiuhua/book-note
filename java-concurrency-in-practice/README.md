# java concurrency in practice

> 编写正确的并发程序的关键是对共享变量、可变的状态进行访问管理

- 因为程序调度的基本单元是线程，一个单线程应用一次只能运行在一个处理器上，
在双处理器系统中，一个单线程程序，放弃了其中一半的空闲资源；
在拥有100个处理器的系统中，这个单线程程序放弃了90%的资源；

- 无论何时，只要有多余一个的线程访问指定的状态变量，而且其中某个线程会写入该变量，此时必须使用同步来协调线程对变量的访问

- 一个类线程安全的，是指在被多个线程范围访问时，类可以持续进行正确的行为

- check-then-act: 你观察一些事情为真（文件X不存在），然后（then）基于你的观察去执行一些动作（创建文件X）；
但事实上，从观察到执行操作的这段时间内，观察结果可能已经无效了（有人在此期间创建了文件X），从而引发错误（非预期的异常，
重写数据或者破坏文件）

- 惰性初始化中的竞争条件

- 当一个不变约束涉及多个变量时，变量间不是彼此独立的；某变量的值会制约其他几个变量的值。
因此，更新一个变量的时候，要在统一原子操作中更新其他几个。

- 内部锁

- 可重入

- 不可以将一个原子操作分解到多个synchronized中，不过应尽量从synchronized中分离出耗时且不影响共享状态的操作

- 